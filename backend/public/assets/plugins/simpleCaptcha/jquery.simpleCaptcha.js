!function(e){var a="simpleCaptcha";e.fn.simpleCaptcha=function(t){var s,n=e(this);if(t=t||{},1===n.length&&n.hasClass(a)&&n.data(a)&&t&&t.length){if((s=n.data(a))&&"refresh"===t)s.refresh();else if(s)return s[t]}else!t.node&&n.length&&(t.node=n.filter(":first"));return!s&&t.node&&(s=new e.jk.SimpleCaptcha(t)).loadImageData((function(e){e&&s.addImagesToUI()})),s||n.trigger("error."+a,["No node provided for the simpleCaptcha UI"]),n},e.jk||(e.jk={}),e.jk.SimpleCaptcha=function(t){var s,n=this;if(t=t||{},n.data={},t.numImages&&(!Number(t.numImages)||t.numImages<1)&&(t.numImages=n.numImages),e.extend(n,t||{}),n.allowRefresh=!!n.allowRefresh,n.node=e(t.node?t.node:null),!n.node||1!==n.node.length)return n;if((s=n.node).addClass(a).html("").append("<div class='"+n.introClass+"'>"+n.introText+"</div><div class='"+n.imageBoxClass+"'></div><input class='"+a+"Input' name='"+n.inputName+"' type='hidden' value='' />").data(a,n).find("."+n.imageBoxClass).on("click","img."+n.imageClass,(function(t){t.preventDefault(),s.find("img."+n.imageClass).removeClass(a+"Selected");var r=e(this).addClass(a+"Selected").attr("data-hash");return s.find("."+a+"Input").val(r),s.trigger("select."+a,[n,r]),!1})).on("keyup","img."+n.imageClass,(function(a){13!=a.which&&32!=a.which||e(this).click()})),n.allowRefresh){var r=e(n.refreshButton);s.find("."+n.introClass).after("<div class='"+n.refreshClass+"' />").siblings("."+n.refreshClass).append(r),r.on("click",(function(e){return e.preventDefault(),n.refresh(),!1}))}s.trigger("init."+a,[n])},e.extend(e.jk.SimpleCaptcha.prototype,{allowRefresh:!0,scriptPath:"simpleCaptcha.php",numImages:5,introText:"<p>To make sure you are a human, we need you to click on the <span class='captchaText'></span>.</p>",refreshButton:"<img src='refresh.png' class='refreshButton' alt='Refresh' title='Refresh captcha options' />",refreshClass:"refreshCaptcha",inputName:"captchaSelection",introClass:"captchaIntro",textClass:"captchaText",imageBoxClass:"captchaImages",imageClass:"captchaImage",node:null}),e.extend(e.jk.SimpleCaptcha.prototype,{loadImageData:function(t){var s=this;t=e.isFunction(t)?t:function(){},e.ajax({url:s.scriptPath,data:{numImages:s.numImages},type:"post",dataType:"json",success:function(e,n){e&&e.images&&e.text?(s.data=e,s.node.trigger("dataload."+a,[e]),t(e)):(s.node.trigger("error."+a,["Invalid data was returned from the server."]),t(null))},error:function(e,n){console.debug("in error handler:",e),t(null),s.node.trigger("error."+a,["There was a serious problem: "+e.status])}})},addImagesToUI:function(){var e=this;e.node.find("."+e.textClass).text(e.data.text);for(var t="",s=0;s<e.data.images.length;++s)t+="<img class='"+e.imageClass+"' src='"+e.scriptPath+"?hash="+e.data.images[s]+"' alt='' data-hash='"+e.data.images[s]+"' />";e.node.find("."+e.imageBoxClass).html(t),e.node.trigger("ready."+a,[e])},refresh:function(){var e=this;e.node.trigger("refresh."+a,[e]),e.loadImageData((function(a){a&&e.addImagesToUI()}))}})}(jQuery);