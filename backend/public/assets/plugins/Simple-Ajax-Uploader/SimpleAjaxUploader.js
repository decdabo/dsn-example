!function(e,t,s){var i,n=e.ss||{},r=/^\s+/,o=/\s+$/,a=/[xy]/g,u=/.*(\/|\\)/,l=/.*[.]/,c=/[\t\r\n]/g,p=Object.prototype.toString.call(e.HTMLElement).indexOf("Constructor")>0,h=t.createElement("input");h.type="file",i="multiple"in h&&"undefined"!=typeof File&&void 0!==(new XMLHttpRequest).upload,n.obj2string=function(e,t){"use strict";var s=[];for(var i in e)if(e.hasOwnProperty(i)){var r=t?t+"["+i+"]":i,o=e[i];s.push("object"==typeof o?n.obj2string(o,r):encodeURIComponent(r)+"="+encodeURIComponent(o))}return s.join("&")},n.extendObj=function(e,t){"use strict";for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])},n.contains=function(e,t){"use strict";for(var s=e.length;s--;)if(e[s]===t)return!0;return!1},n.removeItem=function(e,t){"use strict";for(var s=e.length;s--;)if(e[s]===t){e.splice(s,1);break}},n.addEvent=function(e,t,s){"use strict";return e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent("on"+t,s),function(){n.removeEvent(e,t,s)}},n.removeEvent=function(e,t,s){"use strict";e.removeEventListener?e.removeEventListener(t,s,!1):e.detachEvent("on"+t,s)},n.newXHR=function(){"use strict";if("undefined"!=typeof XMLHttpRequest)return new e.XMLHttpRequest;if(e.ActiveXObject)try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}},n.parseJSON=function(t){"use strict";if(!t)return!1;if(t=n.trim(t+""),e.JSON&&e.JSON.parse)try{return e.JSON.parse(t+"")}catch(e){return!1}var s,i=null;return!(!t||n.trim(t.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,(function(e,t,n,r){return s&&t&&(i=0),0===i?e:(s=n||t,i+=!r-!n,"")}))))&&new Function("return "+t)()},n.getBox=function(s){"use strict";var i,n,r=0,o=0;if(s.getBoundingClientRect)i=s.getBoundingClientRect(),n=t.documentElement,r=i.top+(e.pageYOffset||n.scrollTop)-(n.clientTop||0),o=i.left+(e.pageXOffset||n.scrollLeft)-(n.clientLeft||0);else do{o+=s.offsetLeft,r+=s.offsetTop}while(s=s.offsetParent);return{top:Math.round(r),left:Math.round(o)}},n.addStyles=function(e,t){"use strict";for(var s in t)t.hasOwnProperty(s)&&(e.style[s]=t[s])},n.copyLayout=function(e,t){"use strict";var s=n.getBox(e);n.addStyles(t,{position:"absolute",left:s.left+"px",top:s.top+"px",width:e.offsetWidth+"px",height:e.offsetHeight+"px"})},n.getUID=function(){"use strict";return"axxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},n.trim=function(e){"use strict";return e.toString().replace(r,"").replace(o,"")},n.getFilename=function(e){"use strict";return e.replace(u,"")},n.getExt=function(e){"use strict";return-1!==e.indexOf(".")?e.replace(l,""):""},n.hasClass=function(e,t){"use strict";return(" "+e.className+" ").replace(c," ").indexOf(" "+t+" ")>=0},n.addClass=function(e,t){"use strict";if(!t||""===t)return!1;n.hasClass(e,t)||(e.className+=" "+t)},n.removeClass=function(){"use strict";var e={};return function(t,s){e[s]||(e[s]=new RegExp("(?:^|\\s)"+s+"(?!\\S)")),t.className=t.className.replace(e[s],"")}}(),n.purge=function(e){"use strict";var t,s,i,r=e.attributes;if(r)for(t=r.length-1;t>=0;t-=1)"function"==typeof e[i=r[t].name]&&(e[i]=null);if(r=e.childNodes)for(s=r.length,t=0;t<s;t+=1)n.purge(e.childNodes[t])},n.remove=function(e){"use strict";e.parentNode&&(n.purge(e),e.parentNode.removeChild(e)),e=null},n.verifyElem=function(s){"use strict";return"undefined"!=typeof jQuery&&s instanceof jQuery?s=s[0]:"string"==typeof s&&("#"==s.charAt(0)&&(s=s.substr(1)),s=t.getElementById(s)),!(!s||1!==s.nodeType)&&("A"==s.nodeName.toUpperCase()&&(s.style.cursor="pointer",n.addEvent(s,"click",(function(t){t&&t.preventDefault?t.preventDefault():e.event&&(e.event.returnValue=!1)}))),s)},n.SimpleUpload=function(e){"use strict";var t,s,r;if(this._opts={button:"",url:"",cors:!1,progressUrl:!1,sessionProgressUrl:!1,nginxProgressUrl:!1,multiple:!1,maxUploads:3,queue:!0,checkProgressInterval:50,keyParamName:"APC_UPLOAD_PROGRESS",sessionProgressName:"PHP_SESSION_UPLOAD_PROGRESS",nginxProgressHeader:"X-Progress-ID",corsInputName:"XHR_CORS_TARGETORIGIN",allowedExtensions:[],accept:"",maxSize:!1,name:"",data:{},autoSubmit:!0,multipart:!1,method:"POST",responseType:"",debug:!1,hoverClass:"",focusClass:"",disabledClass:"",customHeaders:{},onAbort:function(e,t){},onChange:function(e,t,s){},onSubmit:function(e,t,s){},onProgress:function(e){},onUpdateFileSize:function(e){},onComplete:function(e,t,s){},onExtError:function(e,t){},onSizeError:function(e,t){},onError:function(e,t,s,i,n,r){},startXHR:function(e,t,s){},endXHR:function(e,t,s){},startNonXHR:function(e,t){},endNonXHR:function(e,t){}},n.extendObj(this._opts,e),e=null,this._btns=[],this._opts.button instanceof Array)for(s=this._opts.button.length,t=0;t<s;t++)!1!==(r=n.verifyElem(this._opts.button[t]))?this._btns.push(this.rerouteClicks(r)):this.log("Button with array index "+t+" is invalid");else!1!==(r=n.verifyElem(this._opts.button))&&this._btns.push(this.rerouteClicks(r));if(delete this._opts.button,this._btns.length<1||!1===this._btns[0])throw new Error("Invalid button. Make sure the element you're passing exists.");!1===this._opts.multiple&&(this._opts.maxUploads=1),this._queue=[],this._active=0,this._disabled=!1,this._progKeys=[],this._maxFails=10,i||(this._sizeFlags={}),this._createInput(),this.enable()},n.SimpleUpload.prototype={destroy:function(){"use strict";for(var e=this._btns.length;e--;)this._btns[e].off&&this._btns[e].off(),n.removeClass(this._btns[e],this._opts.hoverClass),n.removeClass(this._btns[e],this._opts.focusClass),n.removeClass(this._btns[e],this._opts.disabledClass),this._btns[e].disabled=!1;for(var t in n.remove(this._input.parentNode),this)this.hasOwnProperty(t)&&delete this.prop},log:function(t){"use strict";this._opts.debug&&e.console&&console.log("[uploader] "+t)},setData:function(e){"use strict";this._opts.data=e},setOptions:function(e){"use strict";n.extendObj(this._opts,e)},setProgressBar:function(e){"use strict";this._progBar=n.verifyElem(e)},setPctBox:function(e){"use strict";this._pctBox=n.verifyElem(e)},setFileSizeBox:function(e){"use strict";this._sizeBox=n.verifyElem(e)},setProgressContainer:function(e){"use strict";this._progBox=n.verifyElem(e)},setAbortBtn:function(e,t){"use strict";this._abortBtn=n.verifyElem(e),this._removeAbort=!1,t&&(this._removeAbort=!0)},getQueueSize:function(){"use strict";return this._queue.length},_cycleQueue:function(){"use strict";this._queue.length>0&&this._opts.autoSubmit&&this.submit()},removeCurrent:function(){"use strict";for(var e=this._queue.length;e--;)if(this._queue[e].file===this._file){this._queue.splice(e,1);break}delete this._file,this._cycleQueue()},clearQueue:function(){"use strict";this._queue=[]},disable:function(){"use strict";var e,t=this._btns.length;for(this._disabled=!0;t--;)e=this._btns[t].nodeName.toUpperCase(),n.addClass(this._btns[t],this._opts.disabledClass),"INPUT"!=e&&"BUTTON"!=e||(this._btns[t].disabled=!0);this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(){"use strict";var e=this._btns.length;for(this._disabled=!1;e--;)n.removeClass(this._btns[e],this._opts.disabledClass),this._btns[e].disabled=!1},_getHost:function(e){var s=t.createElement("a");return s.href=e,s.hostname?s.hostname.toLowerCase():e},_createInput:function(){"use strict";var e=this,s=t.createElement("div");this._input=t.createElement("input"),this._input.type="file",this._input.name=this._opts.name,i&&!p&&this._opts.multiple&&(this._input.multiple=!0),"accept"in this._input&&""!==this._opts.accept&&(this._input.accept=this._opts.accept),n.addStyles(s,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583}),n.addStyles(this._input,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer"}),"0"!==s.style.opacity&&(s.style.filter="alpha(opacity=0)"),n.addEvent(this._input,"change",(function(){var t,s,r,o,a=e._overBtn;if(e._input&&""!==e._input.value){if(i){if(t=n.getFilename(e._input.files[0].name),s=n.getExt(t),!1===e._opts.onChange.call(e,t,s,a))return;for(r=e._input.files.length,e._opts.multiple||(r=1),o=0;o<r;o++)e._queue.push({file:e._input.files[o],btn:a})}else{if(t=n.getFilename(e._input.value),s=n.getExt(t),!1===e._opts.onChange.call(e,t,s,a))return;e._queue.push({file:e._input,btn:a})}n.removeClass(e._overBtn,e._opts.hoverClass),n.removeClass(e._overBtn,e._opts.focusClass),n.remove(e._input.parentNode),delete e._input,e._createInput(),e._opts.autoSubmit&&e.submit()}})),n.addEvent(this._input,"mouseover",(function(){n.addClass(e._overBtn,e._opts.hoverClass)})),n.addEvent(this._input,"mouseout",(function(){n.removeClass(e._overBtn,e._opts.hoverClass),n.removeClass(e._overBtn,e._opts.focusClass),e._input.parentNode.style.visibility="hidden"})),n.addEvent(this._input,"focus",(function(){n.addClass(e._overBtn,e._opts.focusClass)})),n.addEvent(this._input,"blur",(function(){n.removeClass(e._overBtn,e._opts.focusClass)})),s.appendChild(this._input),t.body.appendChild(s)},rerouteClicks:function(e){"use strict";var t=this;return e.off=n.addEvent(e,"mouseover",(function(){t._disabled||(t._input||t._createInput(),t._overBtn=e,n.copyLayout(e,t._input.parentNode),t._input.parentNode.style.visibility="visible")})),e},_getFrame:function(){"use strict";var e,s=n.getUID();return navigator.userAgent.indexOf("MSIE 7")>-1?e=t.createElement('<iframe src="javascript:false;" name="'+s+'">'):((e=t.createElement("iframe")).src="javascript:false;",e.name=s),e.style.display="none",e.id=s,t.body.appendChild(e),e},_getForm:function(e,s){"use strict";var i=t.createElement("form"),n=this._opts.url;return i.method="post",i.encoding="multipart/form-data",i.enctype="multipart/form-data",i.style.display="none",this._opts.nginxProgressUrl&&(n=n+(n.indexOf("?")>-1?"&":"?")+encodeURIComponent(this._opts.nginxProgressHeader)+"="+encodeURIComponent(s)),i.action=n,i.target=e.name,t.body.appendChild(i),i},_getHidden:function(e,s){"use strict";var i=t.createElement("input");return i.type="hidden",i.name=e,i.value=s,i},_last:function(e,t,s,i,r){"use strict";e&&(e.innerHTML=""),t&&n.remove(t),s&&(s.innerHTML=""),i&&r&&n.remove(i),this._active--,e=t=s=i=r=null,this._disabled&&this.enable(),this._cycleQueue()},_errorFinish:function(e,t,s,i,r,o,a,u,l,c,p){"use strict";this.log("Upload failed: "+e+" "+t),s=n.parseJSON(s),this._opts.onError.call(this,r,i,e,t,s,p),this._last(o,a,u,l,c),e=t=s=i=r=o=a=u=l=c=p=null},_finish:function(e,t,s,i,r,o,a,u,l,c){"use strict";this.log("Server response: "+s),"json"!=this._opts.responseType.toLowerCase()||!1!==(s=n.parseJSON(s))?(this._opts.onComplete.call(this,i,s,c),this._last(r,o,a,u,l),e=t=s=i=r=o=a=u=l=c=null):this._errorFinish(e,t,!1,"parseerror",i,r,o,u,l,c)},_uploadXhr:function(e,t,i,r,o,a,u,l,c){"use strict";var p,h,d,f=this,_=this._opts,g=n.newXHR(),m={};for(var v in m[_.name]=e,n.extendObj(m,_.data),p=_.url+(_.url.indexOf("?")>-1?"&":"?")+n.obj2string(m),i&&(i.innerHTML=t+"K"),a&&(a.innerHTML="0%"),r&&(r.style.width="0%"),_.onProgress.call(this,0),h=function(n,r){var p,d;try{if(h&&(r||4===g.readyState))if(h=s,g.onreadystatechange=function(){},r)4!==g.readyState&&g.abort(),f._last(i,o,a,u,l),_.onAbort.call(f,e,c);else{p=g.status;try{d=g.statusText}catch(e){d=""}p>=200&&p<300?(_.endXHR.call(f,e,t,c),f._finish(p,d,g.responseText,e,i,o,a,u,l,c)):f._errorFinish(p,d,g.responseText,"error",e,i,o,a,u,l,c)}}catch(t){r||f._errorFinish(-1,t.message,!1,"error",e,i,o,a,u,l,c)}},u&&(d=function(){n.removeEvent(u,"click",d),h&&h(s,!0)},n.addEvent(u,"click",d)),g.onreadystatechange=h,g.open(_.method.toUpperCase(),p,!0),n.addEvent(g.upload,"progress",(function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);_.onProgress.call(f,t),a&&(a.innerHTML=t+"%"),r&&(r.style.width=t+"%")}})),g.setRequestHeader("X-Requested-With","XMLHttpRequest"),g.setRequestHeader("X-File-Name",encodeURIComponent(e)),"json"==_.responseType.toLowerCase()&&g.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),_.customHeaders)_.customHeaders.hasOwnProperty(v)&&g.setRequestHeader(v,_.customHeaders[v]);if(!0===_.multipart){var b=new FormData;for(var x in _.data)_.data.hasOwnProperty(x)&&b.append(x,_.data[x]);b.append(_.name,this._file),this.log("Commencing upload using multipart form"),g.send(b)}else g.setRequestHeader("Content-Type","application/octet-stream"),this.log("Commencing upload using binary stream"),g.send(this._file);this.removeCurrent()},_uploadIframe:function(t,i,r,o,a,u){"use strict";var l,c,p=this,h=this._opts,d=n.getUID(),f=this._getFrame(),_=this._getForm(f,d),g=!1;for(var m in h.sessionProgressUrl?_.appendChild(this._getHidden(h.sessionProgressName,d)):h.progressUrl&&_.appendChild(this._getHidden(h.keyParamName,d)),h.data)h.data.hasOwnProperty(m)&&_.appendChild(this._getHidden(m,h.data[m]));h.cors&&_.appendChild(this._getHidden(h.corsInputName,e.location.href)),_.appendChild(this._file),h.onProgress.call(this,0),a&&(a.innerHTML="0%"),r&&(r.style.width="0%"),h.cors&&(l=n.addEvent(e,"message",(function(e){p._getHost(e.origin)==p._getHost(h.url)?(g=!0,l(),h.endNonXHR.call(p,t,u),p._finish("","",e.data,t,i,o,a,s,s,u)):p.log("Non-matching origin: "+e.origin)}))),c=n.addEvent(f,"load",(function(){if(f.parentNode)if(c(),n.removeItem(p._progKeys,d),p._sizeFlags[d]&&delete p._sizeFlags.key,h.cors)e.setTimeout((function(){n.remove(f),g||p._errorFinish("","",!1,"error",t,i,o,a,s,s,u),h=d=f=i=o=a=u=null}),800);else{try{var r=(f.contentDocument?f.contentDocument:f.contentWindow.document).body.innerHTML;h.endNonXHR.call(p,t,u),p._finish("","",r,t,i,o,a,s,s,u)}catch(e){p._errorFinish("",e.message,!1,"error",t,i,o,a,s,s,u)}n.remove(f),h=d=f=i=o=a=u=null}})),p.log("Commencing upload using iframe"),_.submit(),n.remove(_),_=null,(h.progressUrl||h.nginxProgressUrl||h.sessionProgressUrl)&&(this._progKeys.push(d),e.setTimeout((function(){p._getProg(d,r,i,a,1),r=i=a=null}),h.checkProgressInterval)),this.removeCurrent()},_getProg:function(t,i,r,o,a){"use strict";var u,l,c,p=this,h=this._opts,d=(new Date).getTime();if(t)if(h.nginxProgressUrl?l=h.nginxProgressUrl+"?"+encodeURIComponent(h.nginxProgressHeader)+"="+encodeURIComponent(t)+"&_="+d:h.sessionProgressUrl?l=h.sessionProgressUrl:h.progressUrl&&(l=h.progressUrl+"?progresskey="+encodeURIComponent(t)+"&_="+d),c=function(){var l,d,f,_,g;try{if(c&&(h.cors||4===u.readyState)){c=s,u.onreadystatechange=function(){};try{g=u.statusText,_=u.status}catch(e){g="",_=""}if(h.cors||_>=200&&_<300){if(l=n.parseJSON(u.responseText),a++,!1===l)return void p.log("Error parsing progress response (expecting JSON)");if(h.nginxProgressUrl){if("uploading"==l.state)(d=l.size)>0&&(f=Math.round(l.received/d*100),d=Math.round(d/1024));else if("done"==l.state)f=100;else if("error"==l.state)return void p.log("Error requesting upload progress: "+l.status)}else(h.sessionProgressUrl||h.progressUrl)&&!0===l.success&&(d=l.size,f=l.pct);if(f&&(o&&(o.innerHTML=f+"%"),i&&(i.style.width=f+"%"),h.onProgress.call(p,f)),d&&!p._sizeFlags[t]&&(p._sizeFlags[t]=1,r&&(r.innerHTML=d+"K"),h.onUpdateFileSize.call(p,d)),!f&&!d&&a>=p._maxFails)return void p.log("Failed progress request limit reached");f<100&&n.contains(p._progKeys,t)&&e.setTimeout((function(){p._getProg(t,i,r,o,a),t=i=r=o=a=null}),h.checkProgressInterval)}else n.removeItem(p._progKeys,t),p.log("Error requesting upload progress: "+_+" "+g);u=d=f=_=g=l=null}}catch(e){p.log("Error requesting upload progress: "+e.message)}},h.cors&&!h.sessionProgressUrl){if("undefined"==typeof XDomainRequest)return;(u=new e.XDomainRequest).open("GET",l,!0),u.onprogress=u.ontimeout=function(){},u.onload=c,u.onerror=function(){n.removeItem(p._progKeys,t),t=null,p.log("Error requesting upload progress")}}else{var f,_=h.sessionProgressUrl?"POST":"GET";(u=n.newXHR()).onreadystatechange=c,u.open(_,l,!0),h.sessionProgressUrl&&(f=encodeURIComponent(h.sessionProgressName)+"="+encodeURIComponent(t),u.setRequestHeader("Content-type","application/x-www-form-urlencoded")),h.nginxProgressUrl&&u.setRequestHeader(h.nginxProgressHeader,t),u.setRequestHeader("X-Requested-With","XMLHttpRequest"),u.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),u.send(h.sessionProgressUrl&&f||null)}},_checkFile:function(e,t,s){"use strict";var i=this._opts.allowedExtensions,n=i.length,r=!1;if(n>0){for(t=t.toLowerCase();n--;)if(i[n].toLowerCase()==t){r=!0;break}if(!r)return this.removeCurrent(),this.log("File extension not permitted"),this._opts.onExtError.call(this,e,t),!1}return!(s&&!1!==this._opts.maxSize&&s>this._opts.maxSize&&(this.removeCurrent(),this.log(e+" exceeds "+this._opts.maxSize+"K limit"),this._opts.onSizeError.call(this,e,s),1))},submit:function(){"use strict";var e,t,s;if(!(this._disabled||this._active>=this._opts.maxUploads||this._queue.length<1)&&(this._file=this._queue[0].file,i?(e=n.getFilename(this._file.name),s=Math.round(this._file.size/1024)):e=n.getFilename(this._file.value),t=n.getExt(e),this._checkFile(e,t,s)&&!1!==this._opts.onSubmit.call(this,e,t,this._queue[0].btn))){if(this._active++,(!1===this._opts.multiple||!1===this._opts.queue&&this._active>=this._opts.maxUploads)&&this.disable(),i){if(!1===this._opts.startXHR.call(this,e,s,this._queue[0].btn))return this._disabled&&this.enable(),void this._active--;this._uploadXhr(e,s,this._sizeBox,this._progBar,this._progBox,this._pctBox,this._abortBtn,this._removeAbort,this._queue[0].btn)}else{if(!1===this._opts.startNonXHR.call(this,e,this._queue[0].btn))return this._disabled&&this.enable(),void this._active--;this._uploadIframe(e,this._sizeBox,this._progBar,this._progBox,this._pctBox,this._queue[0].btn)}this._sizeBox=this._progBar=this._progBox=this._pctBox=this._abortBtn=this._removeAbort=null}}},e.ss=n}(window,document);