!function(e,t,s){var n,i,o=e.ss||{},r=/^\s+/,a=/\s+$/,l=/[xy]/g,u=/.*(\/|\\)/,p=/.*[.]/,h=/[\t\r\n]/g,d=Object.prototype.toString.call(e.HTMLElement).indexOf("Constructor")>0,c=t.createElement("input");c.type="file",n="multiple"in c&&"undefined"!=typeof File&&void 0!==(new XMLHttpRequest).upload,o.obj2string=function(e,t){var s=[];for(var n in e)if(e.hasOwnProperty(n)){var i=t?t+"["+n+"]":n,r=e[n];s.push("object"==typeof r?o.obj2string(r,i):encodeURIComponent(i)+"="+encodeURIComponent(r))}return s.join("&")},o.extendObj=function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])},o.contains=function(e,t){for(var s=e.length;s--;)if(e[s]===t)return!0;return!1},o.removeItem=function(e,t){for(var s=e.length;s--;)if(e[s]===t){e.splice(s,1);break}},o.addEvent=function(e,t,s){return e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent("on"+t,s),function(){o.removeEvent(e,t,s)}},o.removeEvent=function(e,t,s){e.removeEventListener?e.removeEventListener(t,s,!1):e.detachEvent("on"+t,s)},o.newXHR=function(){if("undefined"!=typeof XMLHttpRequest)return new e.XMLHttpRequest;if(e.ActiveXObject)try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}},o.parseJSON=function(t){if(!t)return!1;if(t=o.trim(t+""),e.JSON&&e.JSON.parse)try{return e.JSON.parse(t+"")}catch(e){return!1}var s,n=null;return!(!t||o.trim(t.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,(function(e,t,i,o){return s&&t&&(n=0),0===n?e:(s=i||t,n+=!o-!i,"")}))))&&new Function("return "+t)()},o.getBox=function(s){var n,i,o=0,r=0;if(s.getBoundingClientRect)n=s.getBoundingClientRect(),i=t.documentElement,o=n.top+(e.pageYOffset||i.scrollTop)-(i.clientTop||0),r=n.left+(e.pageXOffset||i.scrollLeft)-(i.clientLeft||0);else do{r+=s.offsetLeft,o+=s.offsetTop}while(s=s.offsetParent);return{top:Math.round(o),left:Math.round(r)}},o.addStyles=function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e.style[s]=t[s])},o.copyLayout=function(e,t){var s=o.getBox(e);o.addStyles(t,{position:"absolute",left:s.left+"px",top:s.top+"px",width:e.offsetWidth+"px",height:e.offsetHeight+"px"})},o.getUID=function(){return"axxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(l,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},o.trim=function(e){return e.toString().replace(r,"").replace(a,"")},o.getFilename=function(e){return e.replace(u,"")},o.getExt=function(e){return-1!==e.indexOf(".")?e.replace(p,""):""},o.hasClass=function(e,t){return(" "+e.className+" ").replace(h," ").indexOf(" "+t+" ")>=0},o.addClass=function(e,t){if(!t||""===t)return!1;o.hasClass(e,t)||(e.className+=" "+t)},o.removeClass=(i={},function(e,t){i[t]||(i[t]=new RegExp("(?:^|\\s)"+t+"(?!\\S)")),e.className=e.className.replace(i[t],"")}),o.purge=function(e){var t,s,n,i=e.attributes;if(i)for(t=i.length-1;t>=0;t-=1)"function"==typeof e[n=i[t].name]&&(e[n]=null);if(i=e.childNodes)for(s=i.length,t=0;t<s;t+=1)o.purge(e.childNodes[t])},o.remove=function(e){e.parentNode&&(o.purge(e),e.parentNode.removeChild(e)),e=null},o.verifyElem=function(s){return"undefined"!=typeof jQuery&&s instanceof jQuery?s=s[0]:"string"==typeof s&&("#"==s.charAt(0)&&(s=s.substr(1)),s=t.getElementById(s)),!(!s||1!==s.nodeType)&&("A"==s.nodeName.toUpperCase()&&(s.style.cursor="pointer",o.addEvent(s,"click",(function(t){t&&t.preventDefault?t.preventDefault():e.event&&(e.event.returnValue=!1)}))),s)},o.SimpleUpload=function(e){var t,s,i;if(this._opts={button:"",url:"",cors:!1,progressUrl:!1,sessionProgressUrl:!1,nginxProgressUrl:!1,multiple:!1,maxUploads:3,queue:!0,checkProgressInterval:50,keyParamName:"APC_UPLOAD_PROGRESS",sessionProgressName:"PHP_SESSION_UPLOAD_PROGRESS",nginxProgressHeader:"X-Progress-ID",corsInputName:"XHR_CORS_TARGETORIGIN",allowedExtensions:[],accept:"",maxSize:!1,name:"",data:{},autoSubmit:!0,multipart:!1,method:"POST",responseType:"",debug:!1,hoverClass:"",focusClass:"",disabledClass:"",customHeaders:{},onAbort:function(e,t){},onChange:function(e,t,s){},onSubmit:function(e,t,s){},onProgress:function(e){},onUpdateFileSize:function(e){},onComplete:function(e,t,s){},onExtError:function(e,t){},onSizeError:function(e,t){},onError:function(e,t,s,n,i,o){},startXHR:function(e,t,s){},endXHR:function(e,t,s){},startNonXHR:function(e,t){},endNonXHR:function(e,t){}},o.extendObj(this._opts,e),e=null,this._btns=[],this._opts.button instanceof Array)for(s=this._opts.button.length,t=0;t<s;t++)!1!==(i=o.verifyElem(this._opts.button[t]))?this._btns.push(this.rerouteClicks(i)):this.log("Button with array index "+t+" is invalid");else!1!==(i=o.verifyElem(this._opts.button))&&this._btns.push(this.rerouteClicks(i));if(delete this._opts.button,this._btns.length<1||!1===this._btns[0])throw new Error("Invalid button. Make sure the element you're passing exists.");!1===this._opts.multiple&&(this._opts.maxUploads=1),this._queue=[],this._active=0,this._disabled=!1,this._progKeys=[],this._maxFails=10,n||(this._sizeFlags={}),this._createInput(),this.enable()},o.SimpleUpload.prototype={destroy:function(){for(var e=this._btns.length;e--;)this._btns[e].off&&this._btns[e].off(),o.removeClass(this._btns[e],this._opts.hoverClass),o.removeClass(this._btns[e],this._opts.focusClass),o.removeClass(this._btns[e],this._opts.disabledClass),this._btns[e].disabled=!1;for(var t in o.remove(this._input.parentNode),this)this.hasOwnProperty(t)&&delete this.prop},log:function(t){this._opts.debug&&e.console&&console.log("[uploader] "+t)},setData:function(e){this._opts.data=e},setOptions:function(e){o.extendObj(this._opts,e)},setProgressBar:function(e){this._progBar=o.verifyElem(e)},setPctBox:function(e){this._pctBox=o.verifyElem(e)},setFileSizeBox:function(e){this._sizeBox=o.verifyElem(e)},setProgressContainer:function(e){this._progBox=o.verifyElem(e)},setAbortBtn:function(e,t){this._abortBtn=o.verifyElem(e),this._removeAbort=!1,t&&(this._removeAbort=!0)},getQueueSize:function(){return this._queue.length},_cycleQueue:function(){this._queue.length>0&&this._opts.autoSubmit&&this.submit()},removeCurrent:function(){for(var e=this._queue.length;e--;)if(this._queue[e].file===this._file){this._queue.splice(e,1);break}delete this._file,this._cycleQueue()},clearQueue:function(){this._queue=[]},disable:function(){var e,t=this._btns.length;for(this._disabled=!0;t--;)e=this._btns[t].nodeName.toUpperCase(),o.addClass(this._btns[t],this._opts.disabledClass),"INPUT"!=e&&"BUTTON"!=e||(this._btns[t].disabled=!0);this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(){var e=this._btns.length;for(this._disabled=!1;e--;)o.removeClass(this._btns[e],this._opts.disabledClass),this._btns[e].disabled=!1},_getHost:function(e){var s=t.createElement("a");return s.href=e,s.hostname?s.hostname.toLowerCase():e},_createInput:function(){var e=this,s=t.createElement("div");this._input=t.createElement("input"),this._input.type="file",this._input.name=this._opts.name,n&&!d&&this._opts.multiple&&(this._input.multiple=!0),"accept"in this._input&&""!==this._opts.accept&&(this._input.accept=this._opts.accept),o.addStyles(s,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583}),o.addStyles(this._input,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer"}),"0"!==s.style.opacity&&(s.style.filter="alpha(opacity=0)"),o.addEvent(this._input,"change",(function(){var t,s,i,r,a=e._overBtn;if(e._input&&""!==e._input.value){if(n){if(t=o.getFilename(e._input.files[0].name),s=o.getExt(t),!1===e._opts.onChange.call(e,t,s,a))return;for(i=e._input.files.length,e._opts.multiple||(i=1),r=0;r<i;r++)e._queue.push({file:e._input.files[r],btn:a})}else{if(t=o.getFilename(e._input.value),s=o.getExt(t),!1===e._opts.onChange.call(e,t,s,a))return;e._queue.push({file:e._input,btn:a})}o.removeClass(e._overBtn,e._opts.hoverClass),o.removeClass(e._overBtn,e._opts.focusClass),o.remove(e._input.parentNode),delete e._input,e._createInput(),e._opts.autoSubmit&&e.submit()}})),o.addEvent(this._input,"mouseover",(function(){o.addClass(e._overBtn,e._opts.hoverClass)})),o.addEvent(this._input,"mouseout",(function(){o.removeClass(e._overBtn,e._opts.hoverClass),o.removeClass(e._overBtn,e._opts.focusClass),e._input.parentNode.style.visibility="hidden"})),o.addEvent(this._input,"focus",(function(){o.addClass(e._overBtn,e._opts.focusClass)})),o.addEvent(this._input,"blur",(function(){o.removeClass(e._overBtn,e._opts.focusClass)})),s.appendChild(this._input),t.body.appendChild(s)},rerouteClicks:function(e){var t=this;return e.off=o.addEvent(e,"mouseover",(function(){t._disabled||(t._input||t._createInput(),t._overBtn=e,o.copyLayout(e,t._input.parentNode),t._input.parentNode.style.visibility="visible")})),e},_getFrame:function(){var e,s=o.getUID();return navigator.userAgent.indexOf("MSIE 7")>-1?e=t.createElement('<iframe src="javascript:false;" name="'+s+'">'):((e=t.createElement("iframe")).src="javascript:false;",e.name=s),e.style.display="none",e.id=s,t.body.appendChild(e),e},_getForm:function(e,s){var n=t.createElement("form"),i=this._opts.url;return n.method="post",n.encoding="multipart/form-data",n.enctype="multipart/form-data",n.style.display="none",this._opts.nginxProgressUrl&&(i=i+(i.indexOf("?")>-1?"&":"?")+encodeURIComponent(this._opts.nginxProgressHeader)+"="+encodeURIComponent(s)),n.action=i,n.target=e.name,t.body.appendChild(n),n},_getHidden:function(e,s){var n=t.createElement("input");return n.type="hidden",n.name=e,n.value=s,n},_last:function(e,t,s,n,i){e&&(e.innerHTML=""),t&&o.remove(t),s&&(s.innerHTML=""),n&&i&&o.remove(n),this._active--,e=t=s=n=i=null,this._disabled&&this.enable(),this._cycleQueue()},_errorFinish:function(e,t,s,n,i,r,a,l,u,p,h){this.log("Upload failed: "+e+" "+t),s=o.parseJSON(s),this._opts.onError.call(this,i,n,e,t,s,h),this._last(r,a,l,u,p),e=t=s=n=i=r=a=l=u=p=h=null},_finish:function(e,t,s,n,i,r,a,l,u,p){this.log("Server response: "+s),"json"!=this._opts.responseType.toLowerCase()||!1!==(s=o.parseJSON(s))?(this._opts.onComplete.call(this,n,s,p),this._last(i,r,a,l,u),e=t=s=n=i=r=a=l=u=p=null):this._errorFinish(e,t,!1,"parseerror",n,i,r,l,u,p)},_uploadXhr:function(e,t,n,i,r,a,l,u,p){var h,d,c,f=this,_=this._opts,g=o.newXHR(),m={};for(var v in m[_.name]=e,o.extendObj(m,_.data),h=_.url+(_.url.indexOf("?")>-1?"&":"?")+o.obj2string(m),n&&(n.innerHTML=t+"K"),a&&(a.innerHTML="0%"),i&&(i.style.width="0%"),_.onProgress.call(this,0),d=function(i,o){var h,c;try{if(d&&(o||4===g.readyState))if(d=s,g.onreadystatechange=function(){},o)4!==g.readyState&&g.abort(),f._last(n,r,a,l,u),_.onAbort.call(f,e,p);else{h=g.status;try{c=g.statusText}catch(e){c=""}h>=200&&h<300?(_.endXHR.call(f,e,t,p),f._finish(h,c,g.responseText,e,n,r,a,l,u,p)):f._errorFinish(h,c,g.responseText,"error",e,n,r,a,l,u,p)}}catch(t){o||f._errorFinish(-1,t.message,!1,"error",e,n,r,a,l,u,p)}},l&&(c=function(){o.removeEvent(l,"click",c),d&&d(s,!0)},o.addEvent(l,"click",c)),g.onreadystatechange=d,g.open(_.method.toUpperCase(),h,!0),o.addEvent(g.upload,"progress",(function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);_.onProgress.call(f,t),a&&(a.innerHTML=t+"%"),i&&(i.style.width=t+"%")}})),g.setRequestHeader("X-Requested-With","XMLHttpRequest"),g.setRequestHeader("X-File-Name",encodeURIComponent(e)),"json"==_.responseType.toLowerCase()&&g.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),_.customHeaders)_.customHeaders.hasOwnProperty(v)&&g.setRequestHeader(v,_.customHeaders[v]);if(!0===_.multipart){var b=new FormData;for(var x in _.data)_.data.hasOwnProperty(x)&&b.append(x,_.data[x]);b.append(_.name,this._file),this.log("Commencing upload using multipart form"),g.send(b)}else g.setRequestHeader("Content-Type","application/octet-stream"),this.log("Commencing upload using binary stream"),g.send(this._file);this.removeCurrent()},_uploadIframe:function(t,n,i,r,a,l){var u,p,h=this,d=this._opts,c=o.getUID(),f=this._getFrame(),_=this._getForm(f,c),g=!1;for(var m in d.sessionProgressUrl?_.appendChild(this._getHidden(d.sessionProgressName,c)):d.progressUrl&&_.appendChild(this._getHidden(d.keyParamName,c)),d.data)d.data.hasOwnProperty(m)&&_.appendChild(this._getHidden(m,d.data[m]));d.cors&&_.appendChild(this._getHidden(d.corsInputName,e.location.href)),_.appendChild(this._file),d.onProgress.call(this,0),a&&(a.innerHTML="0%"),i&&(i.style.width="0%"),d.cors&&(u=o.addEvent(e,"message",(function(e){h._getHost(e.origin)==h._getHost(d.url)?(g=!0,u(),d.endNonXHR.call(h,t,l),h._finish("","",e.data,t,n,r,a,s,s,l)):h.log("Non-matching origin: "+e.origin)}))),p=o.addEvent(f,"load",(function(){if(f.parentNode)if(p(),o.removeItem(h._progKeys,c),h._sizeFlags[c]&&delete h._sizeFlags.key,d.cors)e.setTimeout((function(){o.remove(f),g||h._errorFinish("","",!1,"error",t,n,r,a,s,s,l),d=c=f=n=r=a=l=null}),800);else{try{var i=(f.contentDocument?f.contentDocument:f.contentWindow.document).body.innerHTML;d.endNonXHR.call(h,t,l),h._finish("","",i,t,n,r,a,s,s,l)}catch(e){h._errorFinish("",e.message,!1,"error",t,n,r,a,s,s,l)}o.remove(f),d=c=f=n=r=a=l=null}})),h.log("Commencing upload using iframe"),_.submit(),o.remove(_),_=null,(d.progressUrl||d.nginxProgressUrl||d.sessionProgressUrl)&&(this._progKeys.push(c),e.setTimeout((function(){h._getProg(c,i,n,a,1),i=n=a=null}),d.checkProgressInterval)),this.removeCurrent()},_getProg:function(t,n,i,r,a){var l,u,p,h=this,d=this._opts,c=(new Date).getTime();if(t)if(d.nginxProgressUrl?u=d.nginxProgressUrl+"?"+encodeURIComponent(d.nginxProgressHeader)+"="+encodeURIComponent(t)+"&_="+c:d.sessionProgressUrl?u=d.sessionProgressUrl:d.progressUrl&&(u=d.progressUrl+"?progresskey="+encodeURIComponent(t)+"&_="+c),p=function(){var u,c,f,_,g;try{if(p&&(d.cors||4===l.readyState)){p=s,l.onreadystatechange=function(){};try{g=l.statusText,_=l.status}catch(e){g="",_=""}if(d.cors||_>=200&&_<300){if(u=o.parseJSON(l.responseText),a++,!1===u)return void h.log("Error parsing progress response (expecting JSON)");if(d.nginxProgressUrl){if("uploading"==u.state)(c=u.size)>0&&(f=Math.round(u.received/c*100),c=Math.round(c/1024));else if("done"==u.state)f=100;else if("error"==u.state)return void h.log("Error requesting upload progress: "+u.status)}else(d.sessionProgressUrl||d.progressUrl)&&!0===u.success&&(c=u.size,f=u.pct);if(f&&(r&&(r.innerHTML=f+"%"),n&&(n.style.width=f+"%"),d.onProgress.call(h,f)),c&&!h._sizeFlags[t]&&(h._sizeFlags[t]=1,i&&(i.innerHTML=c+"K"),d.onUpdateFileSize.call(h,c)),!f&&!c&&a>=h._maxFails)return void h.log("Failed progress request limit reached");f<100&&o.contains(h._progKeys,t)&&e.setTimeout((function(){h._getProg(t,n,i,r,a),t=n=i=r=a=null}),d.checkProgressInterval)}else o.removeItem(h._progKeys,t),h.log("Error requesting upload progress: "+_+" "+g);l=c=f=_=g=u=null}}catch(e){h.log("Error requesting upload progress: "+e.message)}},d.cors&&!d.sessionProgressUrl){if("undefined"==typeof XDomainRequest)return;(l=new e.XDomainRequest).open("GET",u,!0),l.onprogress=l.ontimeout=function(){},l.onload=p,l.onerror=function(){o.removeItem(h._progKeys,t),t=null,h.log("Error requesting upload progress")}}else{var f,_=d.sessionProgressUrl?"POST":"GET";(l=o.newXHR()).onreadystatechange=p,l.open(_,u,!0),d.sessionProgressUrl&&(f=encodeURIComponent(d.sessionProgressName)+"="+encodeURIComponent(t),l.setRequestHeader("Content-type","application/x-www-form-urlencoded")),d.nginxProgressUrl&&l.setRequestHeader(d.nginxProgressHeader,t),l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),l.send(d.sessionProgressUrl&&f||null)}},_checkFile:function(e,t,s){var n=this._opts.allowedExtensions,i=n.length,o=!1;if(i>0){for(t=t.toLowerCase();i--;)if(n[i].toLowerCase()==t){o=!0;break}if(!o)return this.removeCurrent(),this.log("File extension not permitted"),this._opts.onExtError.call(this,e,t),!1}return!(s&&!1!==this._opts.maxSize&&s>this._opts.maxSize&&(this.removeCurrent(),this.log(e+" exceeds "+this._opts.maxSize+"K limit"),this._opts.onSizeError.call(this,e,s),1))},submit:function(){var e,t,s;if(!(this._disabled||this._active>=this._opts.maxUploads||this._queue.length<1)&&(this._file=this._queue[0].file,n?(e=o.getFilename(this._file.name),s=Math.round(this._file.size/1024)):e=o.getFilename(this._file.value),t=o.getExt(e),this._checkFile(e,t,s)&&!1!==this._opts.onSubmit.call(this,e,t,this._queue[0].btn))){if(this._active++,(!1===this._opts.multiple||!1===this._opts.queue&&this._active>=this._opts.maxUploads)&&this.disable(),n){if(!1===this._opts.startXHR.call(this,e,s,this._queue[0].btn))return this._disabled&&this.enable(),void this._active--;this._uploadXhr(e,s,this._sizeBox,this._progBar,this._progBox,this._pctBox,this._abortBtn,this._removeAbort,this._queue[0].btn)}else{if(!1===this._opts.startNonXHR.call(this,e,this._queue[0].btn))return this._disabled&&this.enable(),void this._active--;this._uploadIframe(e,this._sizeBox,this._progBar,this._progBox,this._pctBox,this._queue[0].btn)}this._sizeBox=this._progBar=this._progBox=this._pctBox=this._abortBtn=this._removeAbort=null}}},e.ss=o}(window,document);